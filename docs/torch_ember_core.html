---

title: Torch Ember Core

keywords: fastai
sidebar: home_sidebar

summary: "Analyzing How Model Improves"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/torch_ember_core.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    {% raw %}
        
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this tutorial, we'll use AlexNet as example, 
We can load AlexNet from <code>torchvision</code></p>
<p>By:</p>
<ul>
<li>Xiaochen Zhang</li>
<li>Lai Wei</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">torchvision.models.alexnet</span> <span class="kn">import</span> <span class="n">AlexNet</span>
<span class="kn">import</span> <span class="nn">torch</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">AlexNet</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Sample-data">Sample data<a class="anchor-link" href="#Sample-data">&#182;</a></h4><p>Create a sample data, something like 2 normalized images in a batch, size 224,224</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">samp</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">224</span><span class="p">,</span><span class="mi">224</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="File,-log,-data,-directory-handler">File, log, data, directory handler<a class="anchor-link" href="#File,-log,-data,-directory-handler">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="tracker" class="doc_header"><code>class</code> <code>tracker</code><a href="" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>tracker</code>(<strong><code>libname</code></strong>, <strong><code>fname</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="emberTracker" class="doc_header"><code>class</code> <code>emberTracker</code><a href="" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>emberTracker</code>(<strong><code>fname</code></strong>) :: <a href="/torchember/torch_ember_core#tracker"><code>tracker</code></a></p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test-on-the-data-tracker">Test on the data tracker<a class="anchor-link" href="#Test-on-the-data-tracker">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">etrack</span> <span class="o">=</span> <span class="n">emberTracker</span><span class="p">(</span><span class="s2">&quot;testmodel&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is how we record the data within other codes</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">etrack</span><span class="p">({</span><span class="s2">&quot;col1&quot;</span><span class="p">:</span><span class="n">i</span><span class="p">,</span><span class="s2">&quot;col2&quot;</span><span class="p">:</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;col3&quot;</span><span class="p">:</span><span class="s2">&quot;hahahha&quot;</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Preview log file</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat <span class="o">{</span>etrack.log_path<span class="o">}</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>cat: /Users/salvor/.torchember/log/testmodel: Is a directory
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Read log as dataframe</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">etrack</span><span class="o">.</span><span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>col1</th>
      <th>col2</th>
      <th>col3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>hahahha</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>2</td>
      <td>hahahha</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>4</td>
      <td>hahahha</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>6</td>
      <td>hahahha</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>8</td>
      <td>hahahha</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5</td>
      <td>10</td>
      <td>hahahha</td>
    </tr>
    <tr>
      <th>6</th>
      <td>6</td>
      <td>12</td>
      <td>hahahha</td>
    </tr>
    <tr>
      <th>7</th>
      <td>7</td>
      <td>14</td>
      <td>hahahha</td>
    </tr>
    <tr>
      <th>8</th>
      <td>8</td>
      <td>16</td>
      <td>hahahha</td>
    </tr>
    <tr>
      <th>9</th>
      <td>9</td>
      <td>18</td>
      <td>hahahha</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0</td>
      <td>0</td>
      <td>hahahha</td>
    </tr>
    <tr>
      <th>11</th>
      <td>1</td>
      <td>2</td>
      <td>hahahha</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2</td>
      <td>4</td>
      <td>hahahha</td>
    </tr>
    <tr>
      <th>13</th>
      <td>3</td>
      <td>6</td>
      <td>hahahha</td>
    </tr>
    <tr>
      <th>14</th>
      <td>4</td>
      <td>8</td>
      <td>hahahha</td>
    </tr>
    <tr>
      <th>15</th>
      <td>5</td>
      <td>10</td>
      <td>hahahha</td>
    </tr>
    <tr>
      <th>16</th>
      <td>6</td>
      <td>12</td>
      <td>hahahha</td>
    </tr>
    <tr>
      <th>17</th>
      <td>7</td>
      <td>14</td>
      <td>hahahha</td>
    </tr>
    <tr>
      <th>18</th>
      <td>8</td>
      <td>16</td>
      <td>hahahha</td>
    </tr>
    <tr>
      <th>19</th>
      <td>9</td>
      <td>18</td>
      <td>hahahha</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>rm <span class="o">{</span>etrack.log_path<span class="o">}</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>rm: /Users/salvor/.torchember/log/testmodel: is a directory
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Save/-Get-JSON-data">Save/ Get JSON data<a class="anchor-link" href="#Save/-Get-JSON-data">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Save dictionary to json data</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">etrack</span><span class="p">[</span><span class="s2">&quot;about_this_model&quot;</span><span class="p">]</span><span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;property1&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;property2&quot;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;property3&quot;</span><span class="p">:</span>
        <span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span>
         <span class="s2">&quot;speed&quot;</span><span class="p">:</span><span class="mi">200</span><span class="p">}</span>
    <span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Read this meta data from json file</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">etrack</span><span class="p">[</span><span class="s2">&quot;about_this_model&quot;</span><span class="p">][</span><span class="s2">&quot;property2&quot;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>False</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Torch-Ember-Core">Torch Ember Core<a class="anchor-link" href="#Torch-Ember-Core">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The essence of torch ember, is to place trackers within modules.</p>
<p>It will decorate the <code>forward</code> function to achieve following purpose</p>
<ul>
<li>What variables come in/out of the module</li>
<li>The happening sequence, containing relationships between sub-modules</li>
<li>The statistics we want for further analysis, eg.<ul>
<li>Min, Max, Mean, Std, of input / outpout tensors</li>
<li>Min, Max, Mean, Std, of model weights at this iteration</li>
<li>Min, Max, Mean, Std, of model weights grad at this iteration</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="moduleTrack" class="doc_header"><code>class</code> <code>moduleTrack</code><a href="https://github.com/raynardj/torchember/tree/master/torchember/core.py#L102" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>moduleTrack</code>(<strong><code>module</code></strong>, <strong><code>name</code></strong>=<em><code>None</code></em>, <strong><code>root_module</code></strong>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_stats" class="doc_header"><code>get_stats</code><a href="https://github.com/raynardj/torchember/tree/master/torchember/core.py#L123" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_stats</code>(<strong><code>tensor</code></strong>)</p>
</blockquote>
<p>The default statistic method, it will capture
shape of the tensor
mean, std, max, min of the tensor
this will return a dictionary</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="torchEmber" class="doc_header"><code>class</code> <code>torchEmber</code><a href="https://github.com/raynardj/torchember/tree/master/torchember/core.py#L145" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>torchEmber</code>(<strong><code>model</code></strong>, <strong><code>verbose</code></strong>=<em><code>True</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Tracking-a-model-!!">Tracking a model !!<a class="anchor-link" href="#Tracking-a-model-!!">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Start tracking a model</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">te</span> <span class="o">=</span> <span class="n">torchEmber</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="ansi-green-intense-fg">start analyzing model</span>
<span class="ansi-yellow-intense-fg">[ARMING][START]2020-03-03 23:50:54</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet)]2020-03-03 23:50:54</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential)]2020-03-03 23:50:54</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).0(Conv2d)]2020-03-03 23:50:54</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).1(ReLU)]2020-03-03 23:50:54</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).2(MaxPool2d)]2020-03-03 23:50:54</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).3(Conv2d)]2020-03-03 23:50:54</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).4(ReLU)]2020-03-03 23:50:54</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).5(MaxPool2d)]2020-03-03 23:50:54</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).6(Conv2d)]2020-03-03 23:50:54</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).7(ReLU)]2020-03-03 23:50:54</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).8(Conv2d)]2020-03-03 23:50:54</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).9(ReLU)]2020-03-03 23:50:54</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).10(Conv2d)]2020-03-03 23:50:54</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).11(ReLU)]2020-03-03 23:50:54</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).12(MaxPool2d)]2020-03-03 23:50:54</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).avgpool(AdaptiveAvgPool2d)]2020-03-03 23:50:54</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).classifier(Sequential)]2020-03-03 23:50:54</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).classifier(Sequential).0(Dropout)]2020-03-03 23:50:54</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).classifier(Sequential).1(Linear)]2020-03-03 23:50:54</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).classifier(Sequential).2(ReLU)]2020-03-03 23:50:54</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).classifier(Sequential).3(Dropout)]2020-03-03 23:50:54</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).classifier(Sequential).4(Linear)]2020-03-03 23:50:54</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).classifier(Sequential).5(ReLU)]2020-03-03 23:50:54</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).classifier(Sequential).6(Linear)]2020-03-03 23:50:54</span>
<span class="ansi-yellow-intense-fg">[ARMING][SUCCESS]2020-03-03 23:50:54</span>
<span class="ansi-green-intense-fg">[INFO][20200303_235054]Creating meta data</span>
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Remove the trackers we placed</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">disarm</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="ansi-blue-intense-fg">[DISARM][model(AlexNet)]2020-03-03 23:50:54</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential)]2020-03-03 23:50:54</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).0(Conv2d)]2020-03-03 23:50:54</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).1(ReLU)]2020-03-03 23:50:54</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).2(MaxPool2d)]2020-03-03 23:50:54</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).3(Conv2d)]2020-03-03 23:50:54</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).4(ReLU)]2020-03-03 23:50:54</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).5(MaxPool2d)]2020-03-03 23:50:54</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).6(Conv2d)]2020-03-03 23:50:54</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).7(ReLU)]2020-03-03 23:50:54</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).8(Conv2d)]2020-03-03 23:50:54</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).9(ReLU)]2020-03-03 23:50:54</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).10(Conv2d)]2020-03-03 23:50:54</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).11(ReLU)]2020-03-03 23:50:54</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).12(MaxPool2d)]2020-03-03 23:50:54</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).avgpool(AdaptiveAvgPool2d)]2020-03-03 23:50:54</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).classifier(Sequential)]2020-03-03 23:50:54</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).classifier(Sequential).0(Dropout)]2020-03-03 23:50:54</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).classifier(Sequential).1(Linear)]2020-03-03 23:50:54</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).classifier(Sequential).2(ReLU)]2020-03-03 23:50:54</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).classifier(Sequential).3(Dropout)]2020-03-03 23:50:54</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).classifier(Sequential).4(Linear)]2020-03-03 23:50:54</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).classifier(Sequential).5(ReLU)]2020-03-03 23:50:54</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).classifier(Sequential).6(Linear)]2020-03-03 23:50:54</span>
<span class="ansi-blue-intense-fg">[DISARM][DONE]2020-03-03 23:50:54</span>
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Or like this</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">te</span><span class="o">.</span><span class="n">disarm</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="ansi-blue-intense-fg">[DISARM][model(AlexNet)]2020-03-03 23:50:55</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential)]2020-03-03 23:50:55</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).0(Conv2d)]2020-03-03 23:50:55</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).1(ReLU)]2020-03-03 23:50:55</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).2(MaxPool2d)]2020-03-03 23:50:55</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).3(Conv2d)]2020-03-03 23:50:55</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).4(ReLU)]2020-03-03 23:50:55</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).5(MaxPool2d)]2020-03-03 23:50:55</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).6(Conv2d)]2020-03-03 23:50:55</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).7(ReLU)]2020-03-03 23:50:55</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).8(Conv2d)]2020-03-03 23:50:55</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).9(ReLU)]2020-03-03 23:50:55</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).10(Conv2d)]2020-03-03 23:50:55</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).11(ReLU)]2020-03-03 23:50:55</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).12(MaxPool2d)]2020-03-03 23:50:55</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).avgpool(AdaptiveAvgPool2d)]2020-03-03 23:50:55</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).classifier(Sequential)]2020-03-03 23:50:55</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).classifier(Sequential).0(Dropout)]2020-03-03 23:50:55</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).classifier(Sequential).1(Linear)]2020-03-03 23:50:55</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).classifier(Sequential).2(ReLU)]2020-03-03 23:50:55</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).classifier(Sequential).3(Dropout)]2020-03-03 23:50:55</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).classifier(Sequential).4(Linear)]2020-03-03 23:50:55</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).classifier(Sequential).5(ReLU)]2020-03-03 23:50:55</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).classifier(Sequential).6(Linear)]2020-03-03 23:50:55</span>
<span class="ansi-blue-intense-fg">[DISARM][DONE]2020-03-03 23:50:55</span>
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Okay, refresh the tracker</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">te</span><span class="o">.</span><span class="n">rearm</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="ansi-blue-intense-fg">[DISARM][model(AlexNet)]2020-03-03 23:50:56</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential)]2020-03-03 23:50:56</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).0(Conv2d)]2020-03-03 23:50:56</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).1(ReLU)]2020-03-03 23:50:56</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).2(MaxPool2d)]2020-03-03 23:50:56</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).3(Conv2d)]2020-03-03 23:50:56</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).4(ReLU)]2020-03-03 23:50:56</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).5(MaxPool2d)]2020-03-03 23:50:56</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).6(Conv2d)]2020-03-03 23:50:56</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).7(ReLU)]2020-03-03 23:50:56</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).8(Conv2d)]2020-03-03 23:50:56</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).9(ReLU)]2020-03-03 23:50:56</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).10(Conv2d)]2020-03-03 23:50:56</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).11(ReLU)]2020-03-03 23:50:56</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).features(Sequential).12(MaxPool2d)]2020-03-03 23:50:56</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).avgpool(AdaptiveAvgPool2d)]2020-03-03 23:50:56</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).classifier(Sequential)]2020-03-03 23:50:56</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).classifier(Sequential).0(Dropout)]2020-03-03 23:50:56</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).classifier(Sequential).1(Linear)]2020-03-03 23:50:56</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).classifier(Sequential).2(ReLU)]2020-03-03 23:50:56</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).classifier(Sequential).3(Dropout)]2020-03-03 23:50:56</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).classifier(Sequential).4(Linear)]2020-03-03 23:50:56</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).classifier(Sequential).5(ReLU)]2020-03-03 23:50:56</span>
<span class="ansi-blue-intense-fg">[DISARM][model(AlexNet).classifier(Sequential).6(Linear)]2020-03-03 23:50:56</span>
<span class="ansi-blue-intense-fg">[DISARM][DONE]2020-03-03 23:50:56</span>
<span class="ansi-yellow-intense-fg">[ARMING][START]2020-03-03 23:50:56</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet)]2020-03-03 23:50:56</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential)]2020-03-03 23:50:56</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).0(Conv2d)]2020-03-03 23:50:56</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).1(ReLU)]2020-03-03 23:50:56</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).2(MaxPool2d)]2020-03-03 23:50:56</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).3(Conv2d)]2020-03-03 23:50:56</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).4(ReLU)]2020-03-03 23:50:56</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).5(MaxPool2d)]2020-03-03 23:50:56</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).6(Conv2d)]2020-03-03 23:50:56</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).7(ReLU)]2020-03-03 23:50:56</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).8(Conv2d)]2020-03-03 23:50:56</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).9(ReLU)]2020-03-03 23:50:56</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).10(Conv2d)]2020-03-03 23:50:56</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).11(ReLU)]2020-03-03 23:50:56</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).features(Sequential).12(MaxPool2d)]2020-03-03 23:50:56</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).avgpool(AdaptiveAvgPool2d)]2020-03-03 23:50:56</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).classifier(Sequential)]2020-03-03 23:50:56</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).classifier(Sequential).0(Dropout)]2020-03-03 23:50:56</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).classifier(Sequential).1(Linear)]2020-03-03 23:50:56</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).classifier(Sequential).2(ReLU)]2020-03-03 23:50:56</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).classifier(Sequential).3(Dropout)]2020-03-03 23:50:56</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).classifier(Sequential).4(Linear)]2020-03-03 23:50:56</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).classifier(Sequential).5(ReLU)]2020-03-03 23:50:56</span>
<span class="ansi-cyan-intense-fg">[BUILD FORWARD][model(AlexNet).classifier(Sequential).6(Linear)]2020-03-03 23:50:56</span>
<span class="ansi-yellow-intense-fg">[ARMING][SUCCESS]2020-03-03 23:50:56</span>
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Run forward pass for 3 iterations, nothing strange happend</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">te</span><span class="o">.</span><span class="n">mark</span><span class="p">(</span><span class="n">phase</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">te</span><span class="o">.</span><span class="n">mark</span><span class="p">(</span><span class="n">epoch</span><span class="o">=</span><span class="n">epoch</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">te</span><span class="o">.</span><span class="n">add_extra</span><span class="p">(</span><span class="n">n_batch</span><span class="o">=</span><span class="n">batch</span><span class="p">)</span>
        <span class="n">model</span><span class="p">(</span><span class="n">samp</span><span class="p">)</span>
<span class="n">te</span><span class="o">.</span><span class="n">mark</span><span class="p">(</span><span class="n">phase</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">te</span><span class="o">.</span><span class="n">mark</span><span class="p">(</span><span class="n">epoch</span><span class="o">=</span><span class="n">epoch</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">te</span><span class="o">.</span><span class="n">add_extra</span><span class="p">(</span><span class="n">n_batch</span><span class="o">=</span><span class="n">batch</span><span class="p">)</span>
        <span class="n">model</span><span class="p">(</span><span class="n">samp</span><span class="p">)</span>
<span class="n">te</span><span class="o">.</span><span class="n">after_train</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls -l ~/.torchember/log/AlexNet_20200303_235054
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>total 400
-rw-r--r--  1 salvor  staff  59804 Mar  3 23:51 init-00_phase-train_epoch-0.log
-rw-r--r--  1 salvor  staff  59832 Mar  3 23:51 init-00_phase-train_epoch-1.log
-rw-r--r--  1 salvor  staff  39868 Mar  3 23:51 init-00_phase-valid_epoch-0.log
-rw-r--r--  1 salvor  staff  39859 Mar  3 23:51 init-00_phase-valid_epoch-1.log
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Check-snowballing-tensor-stats">Check snowballing tensor stats<a class="anchor-link" href="#Check-snowballing-tensor-stats">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">te</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>shape</th>
      <th>mean</th>
      <th>std</th>
      <th>max</th>
      <th>min</th>
      <th>cnt_zero</th>
      <th>zero_pct</th>
      <th>module</th>
      <th>ts</th>
      <th>ttype</th>
      <th>tname</th>
      <th>n_batch</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[2, 3, 224, 224]</td>
      <td>-1.000057</td>
      <td>0.577234</td>
      <td>-0.000005</td>
      <td>-1.999995</td>
      <td>0</td>
      <td>0.0</td>
      <td>model(AlexNet)</td>
      <td>2020-03-03 23:51:12</td>
      <td>input</td>
      <td>x</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[2, 3, 224, 224]</td>
      <td>-1.000057</td>
      <td>0.577234</td>
      <td>-0.000005</td>
      <td>-1.999995</td>
      <td>0</td>
      <td>0.0</td>
      <td>model(AlexNet).features(Sequential)</td>
      <td>2020-03-03 23:51:12</td>
      <td>input</td>
      <td>input</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>[2, 3, 224, 224]</td>
      <td>-1.000057</td>
      <td>0.577234</td>
      <td>-0.000005</td>
      <td>-1.999995</td>
      <td>0</td>
      <td>0.0</td>
      <td>model(AlexNet).features(Sequential).0(Conv2d)</td>
      <td>2020-03-03 23:51:12</td>
      <td>input</td>
      <td>input</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>[64, 3, 11, 11]</td>
      <td>-0.000027</td>
      <td>0.030262</td>
      <td>0.052485</td>
      <td>-0.052486</td>
      <td>0</td>
      <td>0.0</td>
      <td>model(AlexNet).features(Sequential).0(Conv2d)</td>
      <td>2020-03-03 23:51:12</td>
      <td>weight</td>
      <td>weight_0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>[64]</td>
      <td>-0.001849</td>
      <td>0.029150</td>
      <td>0.052460</td>
      <td>-0.048437</td>
      <td>0</td>
      <td>0.0</td>
      <td>model(AlexNet).features(Sequential).0(Conv2d)</td>
      <td>2020-03-03 23:51:12</td>
      <td>weight</td>
      <td>weight_1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>123</th>
      <td>[1000, 4096]</td>
      <td>-0.000004</td>
      <td>0.009020</td>
      <td>0.015625</td>
      <td>-0.015625</td>
      <td>0</td>
      <td>0.0</td>
      <td>model(AlexNet).classifier(Sequential).6(Linear)</td>
      <td>2020-03-03 23:51:14</td>
      <td>weight</td>
      <td>weight_0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>124</th>
      <td>[1000]</td>
      <td>-0.000127</td>
      <td>0.008769</td>
      <td>0.015615</td>
      <td>-0.015500</td>
      <td>0</td>
      <td>0.0</td>
      <td>model(AlexNet).classifier(Sequential).6(Linear)</td>
      <td>2020-03-03 23:51:14</td>
      <td>weight</td>
      <td>weight_1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>125</th>
      <td>[2, 1000]</td>
      <td>-0.000347</td>
      <td>0.011486</td>
      <td>0.033753</td>
      <td>-0.034803</td>
      <td>0</td>
      <td>0.0</td>
      <td>model(AlexNet).classifier(Sequential).6(Linear)</td>
      <td>2020-03-03 23:51:14</td>
      <td>output</td>
      <td>output_0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>126</th>
      <td>[2, 1000]</td>
      <td>-0.000347</td>
      <td>0.011486</td>
      <td>0.033753</td>
      <td>-0.034803</td>
      <td>0</td>
      <td>0.0</td>
      <td>model(AlexNet).classifier(Sequential)</td>
      <td>2020-03-03 23:51:14</td>
      <td>output</td>
      <td>output_0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>127</th>
      <td>[2, 1000]</td>
      <td>-0.000347</td>
      <td>0.011486</td>
      <td>0.033753</td>
      <td>-0.034803</td>
      <td>0</td>
      <td>0.0</td>
      <td>model(AlexNet)</td>
      <td>2020-03-03 23:51:14</td>
      <td>output</td>
      <td>output_0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>128 rows × 12 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now let's start record weight grad data, once we use backward(), we'll soon have grad data kick in when next forward pass is called</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Track-weight-gradients">Track weight gradients<a class="anchor-link" href="#Track-weight-gradients">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">model</span><span class="p">(</span><span class="n">samp</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As you can see here, for conv layer,</p>
<ul>
<li>grad_0 is for the 1st weight grad tensor(weight), </li>
<li>grad_1 is for the 2nd(bias)</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">te</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">te</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;ttype&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;weight_grad&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>shape</th>
      <th>mean</th>
      <th>std</th>
      <th>max</th>
      <th>min</th>
      <th>cnt_zero</th>
      <th>zero_pct</th>
      <th>module</th>
      <th>ts</th>
      <th>ttype</th>
      <th>tname</th>
      <th>n_batch</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>196</th>
      <td>[64, 3, 11, 11]</td>
      <td>5.763019e-06</td>
      <td>0.000020</td>
      <td>0.000087</td>
      <td>-0.000070</td>
      <td>67</td>
      <td>0.002884</td>
      <td>model(AlexNet).features(Sequential).0(Conv2d)</td>
      <td>2020-03-03 23:51:49</td>
      <td>weight_grad</td>
      <td>grad_0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>198</th>
      <td>[64]</td>
      <td>-5.816310e-06</td>
      <td>0.000018</td>
      <td>0.000041</td>
      <td>-0.000059</td>
      <td>0</td>
      <td>0.000000</td>
      <td>model(AlexNet).features(Sequential).0(Conv2d)</td>
      <td>2020-03-03 23:51:49</td>
      <td>weight_grad</td>
      <td>grad_1</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>206</th>
      <td>[192, 64, 5, 5]</td>
      <td>-1.541117e-06</td>
      <td>0.000016</td>
      <td>0.000106</td>
      <td>-0.000138</td>
      <td>38819</td>
      <td>0.126364</td>
      <td>model(AlexNet).features(Sequential).3(Conv2d)</td>
      <td>2020-03-03 23:51:49</td>
      <td>weight_grad</td>
      <td>grad_0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>208</th>
      <td>[192]</td>
      <td>-2.695832e-06</td>
      <td>0.000022</td>
      <td>0.000062</td>
      <td>-0.000080</td>
      <td>6</td>
      <td>0.031250</td>
      <td>model(AlexNet).features(Sequential).3(Conv2d)</td>
      <td>2020-03-03 23:51:49</td>
      <td>weight_grad</td>
      <td>grad_1</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>216</th>
      <td>[384, 192, 3, 3]</td>
      <td>-5.951989e-07</td>
      <td>0.000012</td>
      <td>0.000155</td>
      <td>-0.000147</td>
      <td>184824</td>
      <td>0.278537</td>
      <td>model(AlexNet).features(Sequential).6(Conv2d)</td>
      <td>2020-03-03 23:51:49</td>
      <td>weight_grad</td>
      <td>grad_0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Module-tree-json">Module tree json<a class="anchor-link" href="#Module-tree-json">&#182;</a></h3><p>This file will be stored at <code>$HOME/.torchember/data/structure_&lt;modelname&gt;_&lt;date&gt;_&lt;time&gt;.json</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">te</span><span class="o">.</span><span class="n">mod_tree</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;name&#39;: &#39;model(AlexNet)&#39;,
 &#39;short&#39;: &#39;model(AlexNet)&#39;,
 &#39;children&#39;: [{&#39;name&#39;: &#39;model(AlexNet).features(Sequential)&#39;,
   &#39;short&#39;: &#39;features(Sequential)&#39;,
   &#39;children&#39;: [{&#39;name&#39;: &#39;model(AlexNet).features(Sequential).0(Conv2d)&#39;,
     &#39;short&#39;: &#39;0(Conv2d)&#39;},
    {&#39;name&#39;: &#39;model(AlexNet).features(Sequential).1(ReLU)&#39;,
     &#39;short&#39;: &#39;1(ReLU)&#39;},
    {&#39;name&#39;: &#39;model(AlexNet).features(Sequential).2(MaxPool2d)&#39;,
     &#39;short&#39;: &#39;2(MaxPool2d)&#39;},
    {&#39;name&#39;: &#39;model(AlexNet).features(Sequential).3(Conv2d)&#39;,
     &#39;short&#39;: &#39;3(Conv2d)&#39;},
    {&#39;name&#39;: &#39;model(AlexNet).features(Sequential).4(ReLU)&#39;,
     &#39;short&#39;: &#39;4(ReLU)&#39;},
    {&#39;name&#39;: &#39;model(AlexNet).features(Sequential).5(MaxPool2d)&#39;,
     &#39;short&#39;: &#39;5(MaxPool2d)&#39;},
    {&#39;name&#39;: &#39;model(AlexNet).features(Sequential).6(Conv2d)&#39;,
     &#39;short&#39;: &#39;6(Conv2d)&#39;},
    {&#39;name&#39;: &#39;model(AlexNet).features(Sequential).7(ReLU)&#39;,
     &#39;short&#39;: &#39;7(ReLU)&#39;},
    {&#39;name&#39;: &#39;model(AlexNet).features(Sequential).8(Conv2d)&#39;,
     &#39;short&#39;: &#39;8(Conv2d)&#39;},
    {&#39;name&#39;: &#39;model(AlexNet).features(Sequential).9(ReLU)&#39;,
     &#39;short&#39;: &#39;9(ReLU)&#39;},
    {&#39;name&#39;: &#39;model(AlexNet).features(Sequential).10(Conv2d)&#39;,
     &#39;short&#39;: &#39;10(Conv2d)&#39;},
    {&#39;name&#39;: &#39;model(AlexNet).features(Sequential).11(ReLU)&#39;,
     &#39;short&#39;: &#39;11(ReLU)&#39;},
    {&#39;name&#39;: &#39;model(AlexNet).features(Sequential).12(MaxPool2d)&#39;,
     &#39;short&#39;: &#39;12(MaxPool2d)&#39;}]},
  {&#39;name&#39;: &#39;model(AlexNet).avgpool(AdaptiveAvgPool2d)&#39;,
   &#39;short&#39;: &#39;avgpool(AdaptiveAvgPool2d)&#39;},
  {&#39;name&#39;: &#39;model(AlexNet).classifier(Sequential)&#39;,
   &#39;short&#39;: &#39;classifier(Sequential)&#39;,
   &#39;children&#39;: [{&#39;name&#39;: &#39;model(AlexNet).classifier(Sequential).0(Dropout)&#39;,
     &#39;short&#39;: &#39;0(Dropout)&#39;},
    {&#39;name&#39;: &#39;model(AlexNet).classifier(Sequential).1(Linear)&#39;,
     &#39;short&#39;: &#39;1(Linear)&#39;},
    {&#39;name&#39;: &#39;model(AlexNet).classifier(Sequential).2(ReLU)&#39;,
     &#39;short&#39;: &#39;2(ReLU)&#39;},
    {&#39;name&#39;: &#39;model(AlexNet).classifier(Sequential).3(Dropout)&#39;,
     &#39;short&#39;: &#39;3(Dropout)&#39;},
    {&#39;name&#39;: &#39;model(AlexNet).classifier(Sequential).4(Linear)&#39;,
     &#39;short&#39;: &#39;4(Linear)&#39;},
    {&#39;name&#39;: &#39;model(AlexNet).classifier(Sequential).5(ReLU)&#39;,
     &#39;short&#39;: &#39;5(ReLU)&#39;},
    {&#39;name&#39;: &#39;model(AlexNet).classifier(Sequential).6(Linear)&#39;,
     &#39;short&#39;: &#39;6(Linear)&#39;}]}]}</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">te</span><span class="o">.</span><span class="n">mt_log</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;enter model(AlexNet)&#39;,
 &#39;enter model(AlexNet).features(Sequential)&#39;,
 &#39;enter model(AlexNet).features(Sequential).0(Conv2d)&#39;,
 &#39;exit model(AlexNet).features(Sequential).0(Conv2d)&#39;,
 &#39;enter model(AlexNet).features(Sequential).1(ReLU)&#39;,
 &#39;exit model(AlexNet).features(Sequential).1(ReLU)&#39;,
 &#39;enter model(AlexNet).features(Sequential).2(MaxPool2d)&#39;,
 &#39;exit model(AlexNet).features(Sequential).2(MaxPool2d)&#39;,
 &#39;enter model(AlexNet).features(Sequential).3(Conv2d)&#39;,
 &#39;exit model(AlexNet).features(Sequential).3(Conv2d)&#39;,
 &#39;enter model(AlexNet).features(Sequential).4(ReLU)&#39;,
 &#39;exit model(AlexNet).features(Sequential).4(ReLU)&#39;,
 &#39;enter model(AlexNet).features(Sequential).5(MaxPool2d)&#39;,
 &#39;exit model(AlexNet).features(Sequential).5(MaxPool2d)&#39;,
 &#39;enter model(AlexNet).features(Sequential).6(Conv2d)&#39;,
 &#39;exit model(AlexNet).features(Sequential).6(Conv2d)&#39;,
 &#39;enter model(AlexNet).features(Sequential).7(ReLU)&#39;,
 &#39;exit model(AlexNet).features(Sequential).7(ReLU)&#39;,
 &#39;enter model(AlexNet).features(Sequential).8(Conv2d)&#39;,
 &#39;exit model(AlexNet).features(Sequential).8(Conv2d)&#39;,
 &#39;enter model(AlexNet).features(Sequential).9(ReLU)&#39;,
 &#39;exit model(AlexNet).features(Sequential).9(ReLU)&#39;,
 &#39;enter model(AlexNet).features(Sequential).10(Conv2d)&#39;,
 &#39;exit model(AlexNet).features(Sequential).10(Conv2d)&#39;,
 &#39;enter model(AlexNet).features(Sequential).11(ReLU)&#39;,
 &#39;exit model(AlexNet).features(Sequential).11(ReLU)&#39;,
 &#39;enter model(AlexNet).features(Sequential).12(MaxPool2d)&#39;,
 &#39;exit model(AlexNet).features(Sequential).12(MaxPool2d)&#39;,
 &#39;exit model(AlexNet).features(Sequential)&#39;,
 &#39;enter model(AlexNet).avgpool(AdaptiveAvgPool2d)&#39;,
 &#39;exit model(AlexNet).avgpool(AdaptiveAvgPool2d)&#39;,
 &#39;enter model(AlexNet).classifier(Sequential)&#39;,
 &#39;enter model(AlexNet).classifier(Sequential).0(Dropout)&#39;,
 &#39;exit model(AlexNet).classifier(Sequential).0(Dropout)&#39;,
 &#39;enter model(AlexNet).classifier(Sequential).1(Linear)&#39;,
 &#39;exit model(AlexNet).classifier(Sequential).1(Linear)&#39;,
 &#39;enter model(AlexNet).classifier(Sequential).2(ReLU)&#39;,
 &#39;exit model(AlexNet).classifier(Sequential).2(ReLU)&#39;,
 &#39;enter model(AlexNet).classifier(Sequential).3(Dropout)&#39;,
 &#39;exit model(AlexNet).classifier(Sequential).3(Dropout)&#39;,
 &#39;enter model(AlexNet).classifier(Sequential).4(Linear)&#39;,
 &#39;exit model(AlexNet).classifier(Sequential).4(Linear)&#39;,
 &#39;enter model(AlexNet).classifier(Sequential).5(ReLU)&#39;,
 &#39;exit model(AlexNet).classifier(Sequential).5(ReLU)&#39;,
 &#39;enter model(AlexNet).classifier(Sequential).6(Linear)&#39;,
 &#39;exit model(AlexNet).classifier(Sequential).6(Linear)&#39;,
 &#39;exit model(AlexNet).classifier(Sequential)&#39;,
 &#39;exit model(AlexNet)&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Check-latest-tensor-stats">Check latest tensor stats<a class="anchor-link" href="#Check-latest-tensor-stats">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">te</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">latest_df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>shape</th>
      <th>mean</th>
      <th>std</th>
      <th>max</th>
      <th>min</th>
      <th>cnt_zero</th>
      <th>zero_pct</th>
      <th>module</th>
      <th>ts</th>
      <th>ttype</th>
      <th>tname</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[2, 3, 224, 224]</td>
      <td>-1.000057</td>
      <td>0.577234</td>
      <td>-0.000005</td>
      <td>-1.999995</td>
      <td>0</td>
      <td>0.000000</td>
      <td>model(AlexNet)</td>
      <td>2020-03-03 23:51:51</td>
      <td>input</td>
      <td>x</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[2, 3, 224, 224]</td>
      <td>-1.000057</td>
      <td>0.577234</td>
      <td>-0.000005</td>
      <td>-1.999995</td>
      <td>0</td>
      <td>0.000000</td>
      <td>model(AlexNet).features(Sequential)</td>
      <td>2020-03-03 23:51:51</td>
      <td>input</td>
      <td>input</td>
    </tr>
    <tr>
      <th>2</th>
      <td>[2, 3, 224, 224]</td>
      <td>-1.000057</td>
      <td>0.577234</td>
      <td>-0.000005</td>
      <td>-1.999995</td>
      <td>0</td>
      <td>0.000000</td>
      <td>model(AlexNet).features(Sequential).0(Conv2d)</td>
      <td>2020-03-03 23:51:51</td>
      <td>input</td>
      <td>input</td>
    </tr>
    <tr>
      <th>3</th>
      <td>[64, 3, 11, 11]</td>
      <td>-0.000027</td>
      <td>0.030262</td>
      <td>0.052485</td>
      <td>-0.052486</td>
      <td>0</td>
      <td>0.000000</td>
      <td>model(AlexNet).features(Sequential).0(Conv2d)</td>
      <td>2020-03-03 23:51:51</td>
      <td>weight</td>
      <td>weight_0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>[64, 3, 11, 11]</td>
      <td>0.000007</td>
      <td>0.000028</td>
      <td>0.000130</td>
      <td>-0.000096</td>
      <td>67</td>
      <td>0.002884</td>
      <td>model(AlexNet).features(Sequential).0(Conv2d)</td>
      <td>2020-03-03 23:51:51</td>
      <td>weight_grad</td>
      <td>grad_0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>75</th>
      <td>[1000]</td>
      <td>-0.000127</td>
      <td>0.008769</td>
      <td>0.015615</td>
      <td>-0.015500</td>
      <td>0</td>
      <td>0.000000</td>
      <td>model(AlexNet).classifier(Sequential).6(Linear)</td>
      <td>2020-03-03 23:51:53</td>
      <td>weight</td>
      <td>weight_1</td>
    </tr>
    <tr>
      <th>76</th>
      <td>[1000]</td>
      <td>0.002000</td>
      <td>0.000000</td>
      <td>0.002000</td>
      <td>0.002000</td>
      <td>0</td>
      <td>0.000000</td>
      <td>model(AlexNet).classifier(Sequential).6(Linear)</td>
      <td>2020-03-03 23:51:53</td>
      <td>weight_grad</td>
      <td>grad_1</td>
    </tr>
    <tr>
      <th>77</th>
      <td>[2, 1000]</td>
      <td>-0.000499</td>
      <td>0.011397</td>
      <td>0.033915</td>
      <td>-0.030265</td>
      <td>0</td>
      <td>0.000000</td>
      <td>model(AlexNet).classifier(Sequential).6(Linear)</td>
      <td>2020-03-03 23:51:53</td>
      <td>output</td>
      <td>output_0</td>
    </tr>
    <tr>
      <th>78</th>
      <td>[2, 1000]</td>
      <td>-0.000499</td>
      <td>0.011397</td>
      <td>0.033915</td>
      <td>-0.030265</td>
      <td>0</td>
      <td>0.000000</td>
      <td>model(AlexNet).classifier(Sequential)</td>
      <td>2020-03-03 23:51:53</td>
      <td>output</td>
      <td>output_0</td>
    </tr>
    <tr>
      <th>79</th>
      <td>[2, 1000]</td>
      <td>-0.000499</td>
      <td>0.011397</td>
      <td>0.033915</td>
      <td>-0.030265</td>
      <td>0</td>
      <td>0.000000</td>
      <td>model(AlexNet)</td>
      <td>2020-03-03 23:51:53</td>
      <td>output</td>
      <td>output_0</td>
    </tr>
  </tbody>
</table>
<p>80 rows × 11 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Redifine-what-you-want-to-record">Redifine what you want to record<a class="anchor-link" href="#Redifine-what-you-want-to-record">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For the default statistic function, you can keep track shape, mean, std, max,min of a tensor.</p>
<p>The afore-mentioned tensor could mean all of the following</p>
<ul>
<li>module input tensors</li>
<li>module output tensors</li>
<li>module weight</li>
<li>gradient of module weight</li>
</ul>
<p>If you have more interesting metrics to follow, you can redifine the statistic tracking function</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Redifine-the-weight-tensor/-weight-grad-tensor--statitic-function">Redifine the weight tensor/ weight grad tensor  statitic function<a class="anchor-link" href="#Redifine-the-weight-tensor/-weight-grad-tensor--statitic-function">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@te</span><span class="o">.</span><span class="n">set_metric</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">weight_stats</span><span class="p">(</span><span class="n">tensor</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;num&quot;</span><span class="p">:</span><span class="n">tensor</span><span class="o">.</span><span class="n">numel</span><span class="p">(),</span><span class="s2">&quot;row_max&quot;</span><span class="p">:</span><span class="nb">list</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tensor</span><span class="p">)}</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Redifine-the-input-or-output-statitic-function">Redifine the input or output statitic function<a class="anchor-link" href="#Redifine-the-input-or-output-statitic-function">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@te</span><span class="o">.</span><span class="n">set_metric</span><span class="p">(</span><span class="s2">&quot;in&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">input_stats</span><span class="p">(</span><span class="n">tensor</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;num&quot;</span><span class="p">:</span><span class="n">tensor</span><span class="o">.</span><span class="n">numel</span><span class="p">(),</span><span class="s2">&quot;row_min&quot;</span><span class="p">:</span><span class="nb">list</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tensor</span><span class="p">)}</span>

<span class="nd">@te</span><span class="o">.</span><span class="n">set_metric</span><span class="p">(</span><span class="s2">&quot;out&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">output_stats</span><span class="p">(</span><span class="n">tensor</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;num&quot;</span><span class="p">:</span><span class="n">tensor</span><span class="o">.</span><span class="n">numel</span><span class="p">(),</span><span class="s2">&quot;row_min&quot;</span><span class="p">:</span><span class="nb">list</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tensor</span><span class="p">)}</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's give 1 forward pass again</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span><span class="p">(</span><span class="n">samp</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([[ 0.0178, -0.0009,  0.0027,  ..., -0.0085, -0.0016, -0.0087],
        [ 0.0171, -0.0024, -0.0035,  ...,  0.0063,  0.0160, -0.0035]],
       grad_fn=&lt;AddmmBackward&gt;)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The latest stats changed</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">te</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">latest_df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>num</th>
      <th>row_min</th>
      <th>module</th>
      <th>ts</th>
      <th>ttype</th>
      <th>tname</th>
      <th>row_max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>301056</td>
      <td>[-1.9999693632125854, -1.9999945163726807]</td>
      <td>model(AlexNet)</td>
      <td>2020-03-03 23:52:12</td>
      <td>input</td>
      <td>x</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>301056</td>
      <td>[-1.9999693632125854, -1.9999945163726807]</td>
      <td>model(AlexNet).features(Sequential)</td>
      <td>2020-03-03 23:52:12</td>
      <td>input</td>
      <td>input</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>301056</td>
      <td>[-1.9999693632125854, -1.9999945163726807]</td>
      <td>model(AlexNet).features(Sequential).0(Conv2d)</td>
      <td>2020-03-03 23:52:12</td>
      <td>input</td>
      <td>input</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>23232</td>
      <td>NaN</td>
      <td>model(AlexNet).features(Sequential).0(Conv2d)</td>
      <td>2020-03-03 23:52:12</td>
      <td>weight</td>
      <td>weight_0</td>
      <td>[0.05223393440246582, 0.052147045731544495, 0....</td>
    </tr>
    <tr>
      <th>4</th>
      <td>23232</td>
      <td>NaN</td>
      <td>model(AlexNet).features(Sequential).0(Conv2d)</td>
      <td>2020-03-03 23:52:12</td>
      <td>weight_grad</td>
      <td>grad_0</td>
      <td>[1.9010796677321196e-05, 7.584694685647264e-05...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>75</th>
      <td>1000</td>
      <td>NaN</td>
      <td>model(AlexNet).classifier(Sequential).6(Linear)</td>
      <td>2020-03-03 23:52:12</td>
      <td>weight</td>
      <td>weight_1</td>
      <td>[0.008336527273058891, 0.00010786205530166626,...</td>
    </tr>
    <tr>
      <th>76</th>
      <td>1000</td>
      <td>NaN</td>
      <td>model(AlexNet).classifier(Sequential).6(Linear)</td>
      <td>2020-03-03 23:52:12</td>
      <td>weight_grad</td>
      <td>grad_1</td>
      <td>[0.003000000026077032, 0.003000000026077032, 0...</td>
    </tr>
    <tr>
      <th>77</th>
      <td>2000</td>
      <td>[-0.03156087547540665, -0.03723128139972687]</td>
      <td>model(AlexNet).classifier(Sequential).6(Linear)</td>
      <td>2020-03-03 23:52:12</td>
      <td>output</td>
      <td>output_0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>78</th>
      <td>2000</td>
      <td>[-0.03156087547540665, -0.03723128139972687]</td>
      <td>model(AlexNet).classifier(Sequential)</td>
      <td>2020-03-03 23:52:12</td>
      <td>output</td>
      <td>output_0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>79</th>
      <td>2000</td>
      <td>[-0.03156087547540665, -0.03723128139972687]</td>
      <td>model(AlexNet)</td>
      <td>2020-03-03 23:52:12</td>
      <td>output</td>
      <td>output_0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>80 rows × 7 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Placing-tracker-on-variables">Placing tracker on variables<a class="anchor-link" href="#Placing-tracker-on-variables">&#182;</a></h2><p>To be experimented here</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">w</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">parameters</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">BuiltinMethodType</span><span class="p">,</span><span class="n">BuiltinFunctionType</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">x3</span> <span class="o">=</span> <span class="n">x1</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="n">x2</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x2</span><span class="o">.</span><span class="n">numel</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>30</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x1</span><span class="o">.</span><span class="n">abs_</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([[0.5395, 0.1158, 0.2436, 0.6968, 0.5318, 0.5479],
        [0.5569, 0.2847, 0.3291, 0.6477, 0.0778, 0.0844],
        [0.0548, 0.5794, 0.4905, 0.6806, 0.6258, 0.2134],
        [0.7322, 0.0742, 0.1259, 0.5159, 0.7725, 0.7967],
        [0.8471, 0.6944, 0.3707, 0.2552, 0.6063, 0.2456]])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">MethodType</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">inspect</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">TorchTensorEmber</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">TensorEmber</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">host_</span> <span class="o">=</span> <span class="n">x</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="nb">dir</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">super_attr</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
            
        <span class="k">def</span> <span class="nf">super_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isbuiltin</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host_</span><span class="p">,</span><span class="n">attr</span><span class="p">))</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> <span class="k">return</span> 
            <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">super</span><span class="p">(),</span><span class="n">attr</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">attr</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">,</span> <span class="n">MethodType</span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="bp">self</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">func</span>
            
    <span class="k">return</span> <span class="n">TensorEmber</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x2</span> <span class="o">=</span> <span class="n">TorchTensorEmber</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>add
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([[0.6532, 0.3970, 0.9357, 0.7104, 0.5795, 1.4977],
        [1.5565, 1.0672, 0.4137, 1.4910, 0.9587, 0.2552],
        [0.2027, 1.4541, 1.2611, 1.3104, 0.6991, 0.5013],
        [1.1817, 1.0199, 0.5722, 0.9614, 1.0298, 1.1048],
        [0.8859, 0.7230, 1.1873, 1.1150, 1.1920, 0.2781]])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x2</span><span class="o">+</span><span class="n">x1</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([[0.6532, 0.3970, 0.9357, 0.7104, 0.5795, 1.4977],
        [1.5565, 1.0672, 0.4137, 1.4910, 0.9587, 0.2552],
        [0.2027, 1.4541, 1.2611, 1.3104, 0.6991, 0.5013],
        [1.1817, 1.0199, 0.5722, 0.9614, 1.0298, 1.1048],
        [0.8859, 0.7230, 1.1873, 1.1150, 1.1920, 0.2781]])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Placing-tracker-on-optimizer">Placing tracker on optimizer<a class="anchor-link" href="#Placing-tracker-on-optimizer">&#182;</a></h2><p>To be experimented here</p>

</div>
</div>
</div>
    {% endraw %}
</div>
 

