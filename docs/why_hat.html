---

title: 10 Why Hat

keywords: fastai
sidebar: home_sidebar

summary: "Analytical approach using Neural Network on tabulate data"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/why_hat.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    {% raw %}
        
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The core engine for project $\large\hat{y}$.</p>
<p>The dataset is from <a href="https://www.kaggle.com/dgomonov/new-york-city-airbnb-open-data#AB_NYC_2019.csv">New York City Airbnb Open Data</a> on kaggle</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;../data&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">CSV_PATH</span> <span class="o">=</span> <span class="n">DATA</span><span class="o">/</span><span class="s2">&quot;AB_NYC_2019.csv&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The AirBnB New York 2019 dataset</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">CSV_PATH</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">FileNotFoundError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-4-d460e89aedef&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>df <span class="ansi-blue-fg">=</span> pd<span class="ansi-blue-fg">.</span>read_csv<span class="ansi-blue-fg">(</span>CSV_PATH<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> df<span class="ansi-blue-fg">.</span>sample<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">10</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pandas/io/parsers.py</span> in <span class="ansi-cyan-fg">parser_f</span><span class="ansi-blue-fg">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, squeeze, prefix, mangle_dupe_cols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, dialect, error_bad_lines, warn_bad_lines, delim_whitespace, low_memory, memory_map, float_precision)</span>
<span class="ansi-green-intense-fg ansi-bold">    683</span>         )
<span class="ansi-green-intense-fg ansi-bold">    684</span> 
<span class="ansi-green-fg">--&gt; 685</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> _read<span class="ansi-blue-fg">(</span>filepath_or_buffer<span class="ansi-blue-fg">,</span> kwds<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    686</span> 
<span class="ansi-green-intense-fg ansi-bold">    687</span>     parser_f<span class="ansi-blue-fg">.</span>__name__ <span class="ansi-blue-fg">=</span> name

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pandas/io/parsers.py</span> in <span class="ansi-cyan-fg">_read</span><span class="ansi-blue-fg">(filepath_or_buffer, kwds)</span>
<span class="ansi-green-intense-fg ansi-bold">    455</span> 
<span class="ansi-green-intense-fg ansi-bold">    456</span>     <span class="ansi-red-fg"># Create the parser.</span>
<span class="ansi-green-fg">--&gt; 457</span><span class="ansi-red-fg">     </span>parser <span class="ansi-blue-fg">=</span> TextFileReader<span class="ansi-blue-fg">(</span>fp_or_buf<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwds<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    458</span> 
<span class="ansi-green-intense-fg ansi-bold">    459</span>     <span class="ansi-green-fg">if</span> chunksize <span class="ansi-green-fg">or</span> iterator<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pandas/io/parsers.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, f, engine, **kwds)</span>
<span class="ansi-green-intense-fg ansi-bold">    893</span>             self<span class="ansi-blue-fg">.</span>options<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#34;has_index_names&#34;</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> kwds<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#34;has_index_names&#34;</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    894</span> 
<span class="ansi-green-fg">--&gt; 895</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">.</span>_make_engine<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>engine<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    896</span> 
<span class="ansi-green-intense-fg ansi-bold">    897</span>     <span class="ansi-green-fg">def</span> close<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pandas/io/parsers.py</span> in <span class="ansi-cyan-fg">_make_engine</span><span class="ansi-blue-fg">(self, engine)</span>
<span class="ansi-green-intense-fg ansi-bold">   1133</span>     <span class="ansi-green-fg">def</span> _make_engine<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> engine<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;c&#34;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1134</span>         <span class="ansi-green-fg">if</span> engine <span class="ansi-blue-fg">==</span> <span class="ansi-blue-fg">&#34;c&#34;</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1135</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>_engine <span class="ansi-blue-fg">=</span> CParserWrapper<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>f<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>self<span class="ansi-blue-fg">.</span>options<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1136</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1137</span>             <span class="ansi-green-fg">if</span> engine <span class="ansi-blue-fg">==</span> <span class="ansi-blue-fg">&#34;python&#34;</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/anaconda3/lib/python3.7/site-packages/pandas/io/parsers.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, src, **kwds)</span>
<span class="ansi-green-intense-fg ansi-bold">   1915</span>         kwds<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#34;usecols&#34;</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>usecols
<span class="ansi-green-intense-fg ansi-bold">   1916</span> 
<span class="ansi-green-fg">-&gt; 1917</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">.</span>_reader <span class="ansi-blue-fg">=</span> parsers<span class="ansi-blue-fg">.</span>TextReader<span class="ansi-blue-fg">(</span>src<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwds<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1918</span>         self<span class="ansi-blue-fg">.</span>unnamed_cols <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_reader<span class="ansi-blue-fg">.</span>unnamed_cols
<span class="ansi-green-intense-fg ansi-bold">   1919</span> 

<span class="ansi-green-fg">pandas/_libs/parsers.pyx</span> in <span class="ansi-cyan-fg">pandas._libs.parsers.TextReader.__cinit__</span><span class="ansi-blue-fg">()</span>

<span class="ansi-green-fg">pandas/_libs/parsers.pyx</span> in <span class="ansi-cyan-fg">pandas._libs.parsers.TextReader._setup_parser_source</span><span class="ansi-blue-fg">()</span>

<span class="ansi-red-fg">FileNotFoundError</span>: [Errno 2] File b&#39;../data/AB_NYC_2019.csv&#39; does not exist: b&#39;../data/AB_NYC_2019.csv&#39;</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Config-how-we-learn-the-columns">Config how we learn the columns<a class="anchor-link" href="#Config-how-we-learn-the-columns">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is a python/console interface, that will</p>
<ul>
<li>guide the user through columns one by one, </li>
<li>let user decide how should we treat a column during the learning</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="RichColumn" class="doc_header"><code>class</code> <code>RichColumn</code><a href="https://github.com/raynardj/torchember/tree/master/torchember/whyhat.py#L15" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>RichColumn</code>(<strong><code>column</code></strong>, <strong><code>is_y</code></strong>=<em><code>False</code></em>, <strong><code>min_occur</code></strong>=<em><code>5</code></em>, <strong><code>is_emb</code></strong>=<em><code>True</code></em>, <strong><code>hidden_size</code></strong>=<em><code>50</code></em>)</p>
</blockquote>
<p>A pandas series manager</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="RichDF" class="doc_header"><code>class</code> <code>RichDF</code><a href="https://github.com/raynardj/torchember/tree/master/torchember/whyhat.py#L91" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>RichDF</code>(<strong><code>df</code></strong>)</p>
</blockquote>
<p>A pandas dataframe manager</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rdf</span> <span class="o">=</span> <span class="n">RichDF</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rdf</span><span class="o">.</span><span class="n">tour</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="ansi-bold">==============================</span>
<span class="ansi-cyan-intense-fg">id</span>
<span class="ansi-red-intense-fg">number? True</span>
Empty DataFrame
Columns: [index, id]
Index: []
<span class="ansi-red-intense-fg">Is this a [C]ontineous, [D]iscrete or a column we do[N]&#39;t need? default N</span>

<span class="ansi-blue-intense-fg">id will not be involved in learning</span>
<span class="ansi-bold">==============================</span>
<span class="ansi-cyan-intense-fg">name</span>
<span class="ansi-red-intense-fg">number? False</span>
                          index  name
0                Hillside Hotel    18
1           Home away from home    17
2  New york Multi-unit building    16
3            Brooklyn Apartment    12
4                  Private Room    11
<span class="ansi-red-intense-fg">Is this a [C]ontineous, [D]iscrete or a column we do[N]&#39;t need? default N</span>
d
<span class="ansi-blue-intense-fg">name set to discrite data</span>
<span class="ansi-bold">==============================</span>
<span class="ansi-cyan-intense-fg">host_id</span>
<span class="ansi-red-intense-fg">number? True</span>
       index  host_id
0  219517861      327
1  107434423      232
2   30283594      121
3  137358866      103
4   12243051       96
<span class="ansi-red-intense-fg">Is this a [C]ontineous, [D]iscrete or a column we do[N]&#39;t need? default N</span>
d
<span class="ansi-blue-intense-fg">host_id set to discrite data</span>
<span class="ansi-bold">==============================</span>
<span class="ansi-cyan-intense-fg">host_name</span>
<span class="ansi-red-intense-fg">number? False</span>
          index  host_name
0       Michael        417
1         David        403
2  Sonder (NYC)        327
3          John        294
4          Alex        279
<span class="ansi-red-intense-fg">Is this a [C]ontineous, [D]iscrete or a column we do[N]&#39;t need? default N</span>
d
<span class="ansi-blue-intense-fg">host_name set to discrite data</span>
<span class="ansi-bold">==============================</span>
<span class="ansi-cyan-intense-fg">neighbourhood_group</span>
<span class="ansi-red-intense-fg">number? False</span>
           index  neighbourhood_group
0      Manhattan                21661
1       Brooklyn                20104
2         Queens                 5666
3          Bronx                 1091
4  Staten Island                  373
<span class="ansi-red-intense-fg">Is this a [C]ontineous, [D]iscrete or a column we do[N]&#39;t need? default N</span>
d
<span class="ansi-blue-intense-fg">neighbourhood_group set to discrite data</span>
<span class="ansi-bold">==============================</span>
<span class="ansi-cyan-intense-fg">neighbourhood</span>
<span class="ansi-red-intense-fg">number? False</span>
                index  neighbourhood
0        Williamsburg           3920
1  Bedford-Stuyvesant           3714
2              Harlem           2658
3            Bushwick           2465
4     Upper West Side           1971
<span class="ansi-red-intense-fg">Is this a [C]ontineous, [D]iscrete or a column we do[N]&#39;t need? default N</span>
d
<span class="ansi-blue-intense-fg">neighbourhood set to discrite data</span>
<span class="ansi-bold">==============================</span>
<span class="ansi-cyan-intense-fg">latitude</span>
<span class="ansi-red-intense-fg">number? True</span>
      index  latitude
0  40.71813        18
1  40.68634        13
2  40.69414        13
3  40.68444        13
4  40.71171        12
<span class="ansi-red-intense-fg">Is this a [C]ontineous, [D]iscrete or a column we do[N]&#39;t need? default N</span>
c
<span class="ansi-blue-intense-fg">latitude set to contineous data</span>
<span class="ansi-bold">==============================</span>
<span class="ansi-cyan-intense-fg">longitude</span>
<span class="ansi-red-intense-fg">number? True</span>
      index  longitude
0 -73.95677         18
1 -73.95427         18
2 -73.95405         17
3 -73.95136         16
4 -73.94791         16
<span class="ansi-red-intense-fg">Is this a [C]ontineous, [D]iscrete or a column we do[N]&#39;t need? default N</span>
c
<span class="ansi-blue-intense-fg">longitude set to contineous data</span>
<span class="ansi-bold">==============================</span>
<span class="ansi-cyan-intense-fg">room_type</span>
<span class="ansi-red-intense-fg">number? False</span>
             index  room_type
0  Entire home/apt      25409
1     Private room      22326
2      Shared room       1160
<span class="ansi-red-intense-fg">Is this a [C]ontineous, [D]iscrete or a column we do[N]&#39;t need? default N</span>
d
<span class="ansi-blue-intense-fg">room_type set to discrite data</span>
<span class="ansi-bold">==============================</span>
<span class="ansi-cyan-intense-fg">price</span>
<span class="ansi-red-intense-fg">number? True</span>
   index  price
0    100   2051
1    150   2047
2     50   1534
3     60   1458
4    200   1401
<span class="ansi-red-intense-fg">Is this a [C]ontineous, [D]iscrete or a column we do[N]&#39;t need? default N</span>
c
<span class="ansi-blue-intense-fg">price set to contineous data</span>
<span class="ansi-bold">==============================</span>
<span class="ansi-cyan-intense-fg">minimum_nights</span>
<span class="ansi-red-intense-fg">number? True</span>
   index  minimum_nights
0      1           12720
1      2           11696
2      3            7999
3     30            3760
4      4            3303
<span class="ansi-red-intense-fg">Is this a [C]ontineous, [D]iscrete or a column we do[N]&#39;t need? default N</span>
c
<span class="ansi-blue-intense-fg">minimum_nights set to contineous data</span>
<span class="ansi-bold">==============================</span>
<span class="ansi-cyan-intense-fg">number_of_reviews</span>
<span class="ansi-red-intense-fg">number? True</span>
   index  number_of_reviews
0      0              10052
1      1               5244
2      2               3465
3      3               2520
4      4               1994
<span class="ansi-red-intense-fg">Is this a [C]ontineous, [D]iscrete or a column we do[N]&#39;t need? default N</span>
c
<span class="ansi-blue-intense-fg">number_of_reviews set to contineous data</span>
<span class="ansi-bold">==============================</span>
<span class="ansi-cyan-intense-fg">last_review</span>
<span class="ansi-red-intense-fg">number? False</span>
        index  last_review
0  2019-06-23         1413
1  2019-07-01         1359
2  2019-06-30         1341
3  2019-06-24          875
4  2019-07-07          718
<span class="ansi-red-intense-fg">Is this a [C]ontineous, [D]iscrete or a column we do[N]&#39;t need? default N</span>

<span class="ansi-blue-intense-fg">last_review will not be involved in learning</span>
<span class="ansi-bold">==============================</span>
<span class="ansi-cyan-intense-fg">reviews_per_month</span>
<span class="ansi-red-intense-fg">number? True</span>
   index  reviews_per_month
0   0.02                919
1   0.05                893
2   1.00                893
3   0.03                804
4   0.16                667
<span class="ansi-red-intense-fg">Is this a [C]ontineous, [D]iscrete or a column we do[N]&#39;t need? default N</span>
c
<span class="ansi-blue-intense-fg">reviews_per_month set to contineous data</span>
<span class="ansi-bold">==============================</span>
<span class="ansi-cyan-intense-fg">calculated_host_listings_count</span>
<span class="ansi-red-intense-fg">number? True</span>
   index  calculated_host_listings_count
0      1                           32303
1      2                            6658
2      3                            2853
3      4                            1440
4      5                             845
<span class="ansi-red-intense-fg">Is this a [C]ontineous, [D]iscrete or a column we do[N]&#39;t need? default N</span>
c
<span class="ansi-blue-intense-fg">calculated_host_listings_count set to contineous data</span>
<span class="ansi-bold">==============================</span>
<span class="ansi-cyan-intense-fg">availability_365</span>
<span class="ansi-red-intense-fg">number? True</span>
   index  availability_365
0      0             17533
1    365              1295
2    364               491
3      1               408
4     89               361
<span class="ansi-red-intense-fg">Is this a [C]ontineous, [D]iscrete or a column we do[N]&#39;t need? default N</span>
c
<span class="ansi-blue-intense-fg">availability_365 set to contineous data</span>
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}
</div>
 

